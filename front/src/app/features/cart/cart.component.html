<div class="p-6 max-w-6xl mx-auto">
  <h2 class="text-2xl font-semibold mb-6">Mon panier</h2>

  <div *ngIf="message" class="mb-4 text-sm text-red-600">{{ message }}</div>

  <div class="mb-6 flex gap-4">
    <button (click)="createCart()" class="bg-blue-600 text-white px-3 py-1 rounded mr-2">Créer un panier</button>
    <button (click)="loadCart()" class="bg-gray-200 px-3 py-1 rounded">Charger le panier</button>
  </div>

  <div *ngIf="loading" class="text-gray-600">Chargement...</div>

  <div *ngIf="!cart && !loading" class="text-gray-600">Aucun panier trouvé — créez-en un.</div>

  <div *ngIf="cart" class="grid grid-cols-1 md:grid-cols-3 gap-6">
    <!-- Left: items list -->
    <div class="md:col-span-2 border rounded p-4">
      <div class="mb-3 text-sm text-gray-500">Panier créé: {{ cart.created_at }}</div>
      <div *ngIf="displayItems.length === 0" class="text-gray-700">Aucun article pour l'instant.</div>

      <div *ngFor="let it of displayItems" class="flex gap-4 items-center py-4 border-b">
        <img [src]="it.product.image || 'https://via.placeholder.com/96'" alt="{{ it.product.name }}" class="w-24 h-24 object-cover rounded" />

        <div class="flex-1">
          <div class="flex items-center justify-between">
            <div>
              <div class="font-semibold text-lg">{{ it.product.name }}</div>
              <div class="text-sm text-gray-500">{{ it.product.category }}</div>
            </div>
            <div class="text-right">
              <div class="text-red-600 font-bold">{{ (it.product.price | number:'1.2-2') }} €</div>
              <div class="text-sm text-gray-500">Total: {{ (it.product.price * it.quantity) | number:'1.2-2' }} €</div>
            </div>
          </div>

          <div class="mt-3 flex items-center gap-3">
            <button (click)="removeItem(it.itemId)" class="px-2 py-1 bg-gray-100 rounded text-sm">Supprimer</button>
            <div class="flex items-center gap-2 border rounded">
              <button (click)="decrementItem(it.itemId)" class="px-3 py-1">-</button>
              <div class="px-4">{{ it.quantity }}</div>
              <button (click)="incrementItem(it.product.id)" class="px-3 py-1">+</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Right: summary -->
    <aside class="md:col-span-1 border rounded p-4 h-full flex flex-col justify-between">
      <div>
        <h3 class="text-lg font-semibold mb-2"><i class="fa-solid fa-receipt mr-2"></i> Récapitulatif</h3>
        <div class="flex justify-between py-2"><span>Sous-total</span><span class="font-semibold">{{ subtotal | number:'1.2-2' }} €</span></div>
        <div class="flex justify-between py-2"><span>TVA incluse (5.5%)</span><span>{{ vat | number:'1.2-2' }} €</span></div>
        <div class="flex justify-between py-2 items-center">
          <span><i class="fa-solid fa-truck mr-2"></i> Livraison</span>
          <span *ngIf="shipping === 0" class="text-green-600 font-semibold">Gratuite</span>
          <span *ngIf="shipping !== 0" class="font-semibold">{{ shipping | number:'1.2-2' }} €</span>
        </div>
        <div class="border-t my-3"></div>
        <div class="flex justify-between text-xl font-bold"><span>Total</span><span>{{ total | number:'1.2-2' }} €</span></div>
      </div>

      <div class="mt-4">
        <div class="text-sm text-gray-600 mb-3"><i class="fa-solid fa-shield-halved mr-2"></i> Paiement sécurisé</div>
        <button class="w-full bg-green-600 text-white py-2 rounded hover:bg-green-700"><i class="fa-solid fa-bag-shopping mr-2"></i> Passer à la caisse</button>
      </div>
    </aside>
  </div>
  
</div>
